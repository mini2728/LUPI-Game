<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>æœ€å°å”¯ä¸€æ•¸éŠæˆ² - ç©å®¶</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="/socket.io/socket.io.js"></script>
  <style>
    :root {
      --primary: #16a34a;       /* è–èª•ç¶  */
      --primary-soft: #bbf7d0;
      --accent: #ef4444;        /* è–èª•ç´… */
      --gold: #facc15;
      --danger: #dc2626;
      --success: #22c55e;
      --bg: #020617;
      --text-main: #f9fafb;
      --text-sub: #9ca3af;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: calc(16px + env(safe-area-inset-top, 0))
               16px
               calc(20px + env(safe-area-inset-bottom, 0));
      position: relative;
      overflow: hidden;
      /* è–èª•å¤œå ´æ™¯èƒŒæ™¯ï¼šä¸Šæ–¹æ˜Ÿç©ºã€ä¸‹æ–¹å¾®å¾®é›ªåœ°ï¼‹è–èª•ç´…ç¶ æšˆé–‹ */
      background:
        radial-gradient(circle at 10% -10%, rgba(248,250,252,0.18), transparent 60%),
        radial-gradient(circle at 90% 0%, rgba(248,113,113,0.3), transparent 60%),
        radial-gradient(circle at 10% 120%, rgba(52,211,153,0.28), transparent 60%),
        linear-gradient(to top, #020617 0%, #020617 40%, #020617 100%);
    }

    /* é£„é›ªæ•ˆæœï¼ˆæ•´å€‹ç•«é¢ä¸Šå±¤ï¼‰ */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background-image:
        radial-gradient(2px 2px at 10% 20%, rgba(255,255,255,0.9), transparent),
        radial-gradient(2px 2px at 30% 80%, rgba(255,255,255,0.8), transparent),
        radial-gradient(2px 2px at 50% 10%, rgba(255,255,255,0.9), transparent),
        radial-gradient(2px 2px at 70% 60%, rgba(255,255,255,0.85), transparent),
        radial-gradient(2px 2px at 90% 30%, rgba(255,255,255,0.9), transparent);
      background-size: 220px 260px;
      opacity: 0.7;
      animation: snow 18s linear infinite;
      mix-blend-mode: screen;
      z-index: 0;
    }

    @keyframes snow {
      0%   { transform: translateY(-40px); }
      100% { transform: translateY(40px); }
    }

    /* å ´æ™¯ï¼šè®“å¡ç‰‡ä¸­é–“ï¼Œå…©å´æœ‰å°è£é£¾ */
    .scene {
      position: relative;
      width: 100%;
      max-width: 520px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      z-index: 1;
    }

    .xmas-side {
      display: none;
    }

    @media (min-width: 640px) {
      .xmas-side {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        font-size: 26px;
        opacity: 0.9;
      }
      .xmas-side span {
        filter: drop-shadow(0 4px 8px rgba(0,0,0,0.6));
      }
    }

    .card {
      width: 100%;
      max-width: 480px;
      background:
        linear-gradient(155deg, rgba(15,23,42,0.98), rgba(15,23,42,0.92)),
        url("data:image/svg+xml,%3Csvg width='160' height='160' viewBox='0 0 160 160' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='10' cy='20' r='1.2' fill='%23ffffff22'/%3E%3Ccircle cx='120' cy='40' r='0.9' fill='%23ffffff33'/%3E%3Ccircle cx='80' cy='120' r='1.1' fill='%23ffffff22'/%3E%3Ccircle cx='30' cy='90' r='0.9' fill='%23ffffff22'/%3E%3Ccircle cx='140' cy='130' r='1.2' fill='%23ffffff33'/%3E%3C/svg%3E");
      background-blend-mode: overlay;
      border-radius: 24px;
      padding: 18px 16px 16px;
      box-shadow:
        0 18px 40px rgba(0,0,0,0.8),
        0 0 0 1px rgba(148,163,184,0.35);
      border: 1px solid rgba(248,250,252,0.14);
      position: relative;
      overflow: hidden;
    }

    /* å¡ç‰‡ä¸Šç·£æ›ç‡ˆæ¢ */
    .card::before {
      content: "";
      position: absolute;
      left: -6px;
      right: -6px;
      top: 0;
      height: 22px;
      background-image:
        radial-gradient(circle at 10% 40%, #f97373 0, #f97373 4px, transparent 4px),
        radial-gradient(circle at 30% 40%, #facc15 0, #facc15 4px, transparent 4px),
        radial-gradient(circle at 50% 40%, #4ade80 0, #4ade80 4px, transparent 4px),
        radial-gradient(circle at 70% 40%, #38bdf8 0, #38bdf8 4px, transparent 4px),
        radial-gradient(circle at 90% 40%, #fb7185 0, #fb7185 4px, transparent 4px);
      background-size: 80px 24px;
      background-repeat: repeat-x;
      filter: drop-shadow(0 3px 4px rgba(0,0,0,0.7));
    }

    /* å³ä¸ŠèŠ±åœˆ */
    .card::after {
      content: "ğŸ„";
      position: absolute;
      right: 12px;
      top: 10px;
      font-size: 26px;
      opacity: 0.9;
      text-shadow: 0 3px 6px rgba(0,0,0,0.8);
    }

    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 8px;
      margin-bottom: 6px;
      margin-top: 12px;
    }

    h1 {
      margin: 0;
      font-size: 22px;
      letter-spacing: 0.06em;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    h1 span.icon {
      font-size: 24px;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.7));
    }

    .subtitle {
      font-size: 12px;
      color: var(--text-sub);
      margin-top: 4px;
      line-height: 1.45;
    }

    .subtitle strong {
      color: var(--gold);
      font-weight: 600;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 11px;
      background: linear-gradient(135deg, rgba(30,64,175,0.96), rgba(15,23,42,0.96));
      border: 1px solid rgba(191,219,254,0.7);
      margin-bottom: 4px;
      white-space: nowrap;
      box-shadow: 0 4px 10px rgba(15,23,42,0.9);
    }

    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 10px rgba(34,197,94,0.8);
    }

    .round-pill {
      font-size: 11px;
      padding: 4px 9px;
      border-radius: 999px;
      background: radial-gradient(circle at top, rgba(248,250,252,0.1), rgba(30,64,175,0.9));
      border: 1px solid rgba(191,219,254,0.8);
      color: #e0f2fe;
      white-space: nowrap;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .round-pill::before {
      content: "ğŸ";
      font-size: 13px;
    }

    .section-title {
      font-size: 13px;
      margin: 10px 0 4px;
      color: var(--text-sub);
      text-align: left;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .section-title::before {
      content: "ğŸ§‘â€ğŸ„";
      font-size: 14px;
    }

    #nameForm {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }

    input[type="text"] {
      flex: 1;
      padding: 9px 11px;
      font-size: 14px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      background: radial-gradient(circle at top, rgba(248,250,252,0.04), rgba(15,23,42,0.98));
      color: var(--text-main);
      outline: none;
    }
    input[type="text"]::placeholder {
      color: #6b7280;
      font-size: 13px;
    }
    input[type="text"]:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(34,197,94,0.55);
    }

    button {
      padding: 9px 14px;
      font-size: 14px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #16a34a, #22c55e);
      color: white;
      font-weight: 700;
      cursor: pointer;
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(22,163,74,0.6);
      transition: transform 0.12s ease-out, box-shadow 0.12s ease-out, filter 0.12s ease-out;
    }
    button:active:not(:disabled) {
      transform: translateY(1px);
      box-shadow: 0 2px 6px rgba(15,23,42,0.8);
    }
    button:hover:not(:disabled) {
      filter: brightness(1.05);
    }
    button:disabled {
      opacity: 0.55;
      cursor: default;
      box-shadow: none;
    }

    #roundInfo {
      font-size: 13px;
      margin-top: 4px;
      margin-bottom: 2px;
      color: var(--text-sub);
      text-align: left;
    }

    #status {
      margin-top: 4px;
      min-height: 38px;
      font-size: 13px;
      text-align: left;
    }

    #status strong {
      color: var(--gold);
    }

    .number-grid {
      display: grid;
      gap: 8px;
      margin-top: 14px;
    }

    @media (max-width: 480px) {
      .number-grid {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }
    @media (min-width: 481px) {
      .number-grid {
        grid-template-columns: repeat(4, minmax(0, 1fr));
      }
    }

    /* æ•¸å­—æŒ‰éˆ•æ”¹æˆã€Œè–èª•çƒã€é¢¨æ ¼ */
    .num-btn {
      padding: 16px 0;
      font-size: 18px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      background:
        radial-gradient(circle at 30% 0%, rgba(255,255,255,0.32), transparent 50%),
        radial-gradient(circle at 50% 120%, rgba(22,163,74,0.65), rgba(15,23,42,1));
      color: var(--text-main);
      cursor: pointer;
      transition: all 0.12s ease-out;
      position: relative;
      overflow: hidden;
      text-shadow: 0 2px 4px rgba(0,0,0,0.8);
    }
    .num-btn::before {
      /* å°é‡‘å±¬æ›å‹¾ */
      content: "";
      position: absolute;
      top: 4px;
      left: 50%;
      width: 12px;
      height: 6px;
      transform: translateX(-50%);
      border-radius: 999px;
      background: linear-gradient(to right, #facc15, #fbbf24);
      box-shadow: 0 2px 4px rgba(0,0,0,0.6);
    }
    .num-btn::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 10% 0%, rgba(248,250,252,0.35), transparent 55%);
      opacity: 0;
      transition: opacity 0.12s ease-out;
    }
    .num-btn:hover:not(:disabled) {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 6px 14px rgba(15,23,42,0.9);
      border-color: var(--gold);
    }
    .num-btn:hover:not(:disabled)::after {
      opacity: 1;
    }
    .num-btn:disabled {
      opacity: 0.28;
      cursor: default;
      box-shadow: none;
    }

    .notice {
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 9px;
      text-align: left;
      line-height: 1.45;
    }

    .danger-text {
      color: #fb7185;
      font-weight: 500;
    }

    .success-text {
      color: #4ade80;
      font-weight: 500;
    }

    /* åº•éƒ¨é‹ªä¸€é»é›ªé‚Šï¼‹ç¦®ç‰© */
    .card-footer-decor {
      margin-top: 14px;
      padding-top: 8px;
      border-top: 1px dashed rgba(148,163,184,0.5);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: var(--text-sub);
    }

    .card-footer-decor .gifts {
      display: flex;
      gap: 4px;
      font-size: 16px;
    }

    @media (max-width: 360px) {
      h1 { font-size: 20px; }
      .subtitle { font-size: 11px; }
      #status { font-size: 12px; }
      .number-grid { gap: 6px; }
      .num-btn { font-size: 16px; padding: 14px 0; }
      .card-footer-decor { flex-direction: column; align-items: flex-start; gap: 6px; }
    }
  </style>
</head>
<body>
  <div class="scene">
    <div class="xmas-side xmas-left">
      <span>ğŸ…</span>
      <span>ğŸ</span>
    </div>

    <div class="card">
      <div class="top-row">
        <div>
          <div class="badge">
            <span class="badge-dot"></span>
            <span id="playerInfo">é€£ç·šä¸­...</span>
          </div>
          <h1><span class="icon">ğŸ…</span>æœ€å°å”¯ä¸€æ•¸</h1>
          <div class="subtitle">
            è–èª•æ´¾å°å°éŠæˆ²ï¼š<strong>æ¯è¼ªé¸ä¸€å€‹æ•¸å­—</strong>ï¼Œ<br>
            é¸åˆ°ã€Œæœ€å°ä¸”åªæœ‰ä½ é¸ã€çš„æ•¸å­—å°±è´äº†ï¼
          </div>
        </div>
        <div class="round-pill" id="roundPill">ç­‰å¾…é–‹å§‹</div>
      </div>

      <div class="section-title">æš±ç¨±è¨­å®š</div>
      <div id="nameForm">
        <input type="text" id="nickname" placeholder="è¼¸å…¥ä½ çš„æš±ç¨±ï¼ˆä¸»æŒäººæœƒçœ‹åˆ°ï¼‰" />
        <button id="btnSetName">é€å‡º</button>
      </div>

      <div id="roundInfo"></div>
      <div id="status"></div>

      <div id="gridContainer" class="number-grid"></div>
      <div class="notice" id="extraHint"></div>

      <div class="card-footer-decor">
        <span>å°æ’‡æ­¥ï¼šç­‰ä¸»æŒäººå£ä»¤å†å‡ºæ‰‹ï¼Œæ›´æœ‰æ´¾å°æ°£æ°› âœ¨</span>
        <div class="gifts">
          <span>ğŸ„</span>
          <span>ğŸ</span>
          <span>â­</span>
        </div>
      </div>
    </div>

    <div class="xmas-side xmas-right">
      <span>ğŸ¦Œ</span>
      <span>ğŸ„</span>
    </div>
  </div>

  <script>
    const socket = io();
    let playerId = null;
    let hasChosen = false;
    let minNumber = 1;
    let maxNumber = 32;
    let hasName = false;
    let eliminated = false;
    let lastState = null;
    const NICK_KEY = 'lowestUniqueNickname';

    const playerInfoDiv = document.getElementById('playerInfo');
    const roundInfoDiv = document.getElementById('roundInfo');
    const roundPill = document.getElementById('roundPill');
    const statusDiv = document.getElementById('status');
    const gridContainer = document.getElementById('gridContainer');
    const nameFormDiv = document.getElementById('nameForm');
    const nicknameInput = document.getElementById('nickname');
    const btnSetName = document.getElementById('btnSetName');
    const extraHint = document.getElementById('extraHint');

    const savedNick = localStorage.getItem(NICK_KEY);
    if (savedNick) {
      nicknameInput.value = savedNick;
    }

    socket.on('playerInfo', (info) => {
      playerId = info.playerId;
      minNumber = info.minNumber;
      maxNumber = info.maxNumber;

      playerInfoDiv.textContent = `ä½ æ˜¯ ${info.name}`;
      if (!nicknameInput.value) {
        nicknameInput.value = info.name;
      }

      buildButtons();
      refreshButtonsEnabled();

      if (savedNick) {
        socket.emit('setName', savedNick);
        hasName = true;
        statusDiv.textContent = 'å·²å¥—ç”¨å„²å­˜çš„æš±ç¨±ï¼Œç­‰å¾…ä¸»æŒäººé–‹å§‹éŠæˆ²ã€‚';
        extraHint.textContent = 'è«‹ç•™åœ¨æ­¤ç•«é¢ï¼Œä¾ç…§ä¸»æŒäººå£ä»¤åœ¨æ¯è¼ªä¸­é¸æ“‡æ•¸å­—ã€‚';
        refreshButtonsEnabled();
      }
    });

    socket.on('spectator', () => {
      playerInfoDiv.textContent = 'ç›®å‰ç„¡æ³•åŠ å…¥éŠæˆ²ï¼Œä½ æ˜¯æ—è§€è€…ã€‚';
      statusDiv.textContent = 'è‹¥ä¸»æŒäººé‡ç½®éŠæˆ²ï¼Œä½ å¯ä»¥é‡æ–°æ•´ç†é é¢å˜—è©¦åŠ å…¥ã€‚';
      roundPill.textContent = 'æ—è§€ä¸­';
      gridContainer.innerHTML = '';
      nameFormDiv.style.display = 'none';
    });

    socket.on('stateUpdate', (state) => {
      lastState = state;

      if (state.round > 0) {
        roundInfoDiv.textContent = `ç›®å‰ç¬¬ ${state.round} è¼ª`;
        roundPill.textContent = `ç¬¬ ${state.round} è¼ª`;
      } else {
        if (state.maxPlayers != null) {
          roundInfoDiv.textContent =
            `éŠæˆ²å°šæœªé–‹å§‹ï¼Œé è¨ˆç©å®¶æ•¸ ${state.maxPlayers} äººï¼Œå·²åŠ å…¥ ${state.joinedCount} äºº`;
        } else {
          roundInfoDiv.textContent = 'éŠæˆ²å°šæœªé–‹å§‹ï¼Œè«‹ç­‰å¾…ä¸»æŒäººè¨­å®šå¯éŠç©äººæ•¸ã€‚';
        }
        roundPill.textContent = 'ç­‰å¾…é–‹å§‹';
      }

      if (playerId != null) {
        const me = state.players.find(p => p.id === playerId);
        if (me) {
          playerInfoDiv.textContent = `ä½ æ˜¯ ${me.name}`;
          hasName = !!me.hasName;
          eliminated = !!me.eliminated;

          if (eliminated) {
            statusDiv.innerHTML = '<span class="success-text">ä½ æ›¾ç¶“ç²å‹ä¸¦å·²æ·˜æ±°å‡ºå±€</span>ï¼Œæ¥ä¸‹ä¾†å¯ä»¥å®‰å¿ƒç•¶è§€çœ¾ ğŸ‰';
            extraHint.textContent = 'ä½ å¯ä»¥ç¹¼çºŒç•™åœ¨ç•«é¢ä¸Šï¼Œçœ‹å…¶ä»–äººæ¯”åˆ°æœ€å¾Œã€‚';
          } else if (me.choice != null) {
            hasChosen = true;
            if (state.choicesVisible) {
              statusDiv.innerHTML = `æœ¬è¼ªä½ é¸çš„æ•¸å­—æ˜¯ <strong>${me.choice}</strong>`;
            } else {
              statusDiv.textContent = 'ä½ æœ¬è¼ªå·²é¸æ“‡ï¼Œè«‹ç­‰å¾…æ‰€æœ‰äººé¸å®Œèˆ‡çµæœå…¬å¸ƒã€‚';
            }
            extraHint.textContent = '';
          } else {
            hasChosen = false;
            if (!hasName) {
              statusDiv.textContent = 'è«‹å…ˆè¼¸å…¥æš±ç¨±ä¸¦é€å‡ºï¼Œæ‰èƒ½åƒåŠ éŠæˆ²ã€‚';
              extraHint.textContent = '';
            } else if (state.round === 0) {
              statusDiv.textContent = 'æš±ç¨±å·²è¨­å®šå®Œæˆï¼Œç­‰å¾…ä¸»æŒäººé–‹å§‹ç¬¬ä¸€è¼ªã€‚';
              extraHint.textContent = 'ä¸»æŒäººå®£å¸ƒé–‹å§‹å¾Œï¼Œæœƒé–‹æ”¾é¸æ“‡æ•¸å­—ã€‚';
            } else if (!state.roundActive) {
              statusDiv.textContent = 'æœ¬è¼ªå°šæœªé–‹å§‹æˆ–å·²çµæŸï¼Œè«‹ç­‰å¾…ä¸»æŒäººé–‹å§‹ä¸‹ä¸€è¼ªã€‚';
              extraHint.textContent = '';
            } else {
              statusDiv.textContent = 'è«‹åœ¨ä¸‹é¢é¸æ“‡ä¸€å€‹æ•¸å­—ã€‚';
              extraHint.textContent = 'é¸å®Œå¾Œä¸èƒ½æ›´æ”¹ï¼Œç›´åˆ°ä¸‹ä¸€è¼ªé–‹å§‹ã€‚';
            }
          }
        }
      }

      refreshButtonsEnabled();
    });

    socket.on('roundResult', (result) => {
      if (playerId != null && result.winners && result.winners.includes(playerId)) {
        statusDiv.innerHTML = `ğŸ‰ ä½ ä»¥æ•¸å­— <strong>${result.lowestUnique}</strong> ç²å‹ä¸¦æ·˜æ±°å‡ºå±€ï¼ï¼ˆç¬¬ ${result.round} è¼ªï¼‰`;
        extraHint.textContent = 'æ¥ä¸‹ä¾†ä½ å°‡ä»¥è§€çœ¾èº«åˆ†è§€çœ‹éŠæˆ²ã€‚';
      }
      refreshButtonsEnabled();
    });

    socket.on('newRound', (data) => {
      if (playerId != null && !eliminated) {
        statusDiv.textContent = `ç¬¬ ${data.round} è¼ªé–‹å§‹ï¼Œè«‹åœ¨ç•«é¢ä¸‹æ–¹é¸æ“‡æ•¸å­—ã€‚`;
        extraHint.textContent = 'ç­‰ä¸»æŒäººå€’æ•¸æˆ–å£ä»¤ï¼Œå†å‡ºæ‰‹æœƒæ›´æœ‰è¶£ ğŸ˜‰';
        hasChosen = false;
        refreshButtonsEnabled();
      }
    });

    socket.on('gameReset', () => {
      statusDiv.innerHTML = '<span class="danger-text">éŠæˆ²å·²è¢«ä¸»æŒäººé‡ç½®ï¼Œè«‹é‡æ–°æ•´ç†é é¢é‡æ–°åŠ å…¥æ–°çš„ä¸€å ´ã€‚</span>';
      extraHint.textContent = '';
      gridContainer.innerHTML = '';
      btnSetName.disabled = true;
      roundPill.textContent = 'å·²é‡ç½®';
    });

    btnSetName.addEventListener('click', () => {
      const name = nicknameInput.value.trim();
      if (!name) {
        alert('æš±ç¨±ä¸èƒ½æ˜¯ç©ºçš„');
        return;
      }
      socket.emit('setName', name);
      hasName = true;
      localStorage.setItem(NICK_KEY, name);
      statusDiv.textContent = 'æš±ç¨±å·²é€å‡ºï¼Œå¯ä»¥ç­‰å¾…ä¸»æŒäººé–‹å§‹æˆ–é€²å…¥ä¸‹ä¸€è¼ªã€‚';
      extraHint.textContent = 'ä¹‹å¾Œé‡æ–°æ•´ç†é é¢ä¹Ÿæœƒè‡ªå‹•å¸¶å…¥é€™å€‹æš±ç¨±ã€‚';
      refreshButtonsEnabled();
    });

    function buildButtons() {
      gridContainer.innerHTML = '';
      for (let n = minNumber; n <= maxNumber; n++) {
        const btn = document.createElement('button');
        btn.className = 'num-btn';
        btn.textContent = n;
        btn.dataset.value = n;
        btn.addEventListener('click', () => chooseNumber(n));
        gridContainer.appendChild(btn);
      }
    }

    // â˜… é€™è£¡æ”¹æˆã€Œå…ˆè·³å‡ºç¢ºèªè¦–çª—ã€â˜…
    function chooseNumber(n) {
      if (hasChosen) return;
      if (!hasName) {
        alert('è«‹å…ˆè¼¸å…¥æš±ç¨±å†é¸æ•¸å­—ã€‚');
        return;
      }
      if (eliminated) {
        alert('ä½ å·²ç¶“è¢«æ·˜æ±°ï¼Œç„¡æ³•å†é¸æ•¸å­—ã€‚');
        return;
      }
      if (!lastState || !lastState.roundActive) {
        alert('æœ¬è¼ªå°šæœªé–‹å§‹æˆ–å·²çµæŸï¼Œè«‹ç­‰å¾…ä¸»æŒäººã€‚');
        return;
      }

      const ok = confirm(`ä½ ç¢ºå®šè¦é¸æ“‡æ•¸å­—ã€Œ${n}ã€å—ï¼Ÿ\n\né¸å®šå¾Œæœ¬è¼ªå°‡ç„¡æ³•æ›´æ”¹ã€‚`);
      if (!ok) {
        return; // ç©å®¶æŒ‰å–æ¶ˆï¼Œå°±ä¸é€å‡º
      }

      socket.emit('chooseNumber', n);
      hasChosen = true;
      refreshButtonsEnabled();
    }

    function refreshButtonsEnabled() {
      const buttons = Array.from(gridContainer.querySelectorAll('button'));
      let disabled = false;

      if (!hasName) disabled = true;
      if (hasChosen) disabled = true;
      if (eliminated) disabled = true;
      if (!lastState || !lastState.roundActive) disabled = true;

      buttons.forEach(b => b.disabled = disabled);
    }
  </script>
</body>
</html>
